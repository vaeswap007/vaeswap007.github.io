import{s as service,_ as _export_sfc,a1 as copy,a2 as ImagePreview,r as resolveComponent,o as openBlock,c as createElementBlock,e as createBlock,k as createCommentVNode,i as createBaseVNode,x as withDirectives,z as vShow,t as toDisplayString,n as normalizeStyle,b as createVNode,w as withCtx,F as Fragment,d as renderList,m as normalizeClass,p as withModifiers,l as createTextVNode,q as pushScopeId,u as popScopeId}from"./index.ac3816d8.js";function getNewsList(e){return service({method:"get",url:"/v1api/v2/discover/news",params:{lang:e.lang,userAddress:e.userAddress,pageNO:e.pageNo,pageSize:e.pageSize}})}function newsVote(e){return service({method:"post",url:"/v1api/v2/discover/newsVote",params:{userAddress:e.userAddress,newsId:e.newsId,vote:e.vote}})}function getNewsAd(){return service({method:"get",url:"/v1api/v2/discover/newsAd"})}var _imports_0="/assets/ave-empty.a9f4da8d.png",news_vue_vue_type_style_index_0_scoped_true_lang="";const _sfc_main={name:"GlobalCommunity",components:{},data(){return{active:-1,list:[],loading:!1,images:[],showAd:eval(localStorage.getItem("showAd")||!0),showNotice:eval(localStorage.getItem("showNotice")||!0),conditions:{pageNo:1,pageSize:10,lang:"",userAddress:""},total:"",day:"",finished:!1,refreshing:!1,top:0,bottom:0,count:0,timer:null,copying:[],index:0,isShowNotice:!1,error:!1}},mounted(){var e;this.$store.commit("switchTypeUpDown",((e=this.$route.query)==null?void 0:e.typeUpDown)||0),this.getNewsList(this.conditions),this.getNewsAd(),this.$nextTick(()=>{var o,a,i,t,n,r;this.top=((i=(a=(o=this.$refs)==null?void 0:o.top)==null?void 0:a.$el)==null?void 0:i.offsetHeight)||0,this.bottom=((r=(n=(t=this.$refs)==null?void 0:t.bottom)==null?void 0:n.$el)==null?void 0:r.offsetHeight)||0}),this.getShowNotice()},computed:{language(){return this.$store.getters.language}},watch:{"$store.state.currentAccount"(e){this.refreshing=!1,this.loading=!1,this.list=[],this.conditions.pageNo=1,this.getNewsList(this.conditions)},showNotice(e){e||(this.top=0)},showAd(e){e||(this.bottom=0)}},methods:{async getShowNotice(){return this.isShowNotice=await this.$f.isShowNotice(),this.isShowNotice},clearTouch(){this.timer&&(clearTimeout(this.timer),this.copying[this.index]=!1)},longTap(e,o){this.copying[o]=!0,this.index=o,clearTimeout(this.timer),this.timer=setTimeout(()=>{var n,r,l,d,_,h,u;this.timer=null;let a="";((l=(r=(n=e.content)==null?void 0:n.items[0])==null?void 0:r.legacy.full_text)==null?void 0:l.length)>500&&e.source!=="twitter"?a=((_=(d=e.content)==null?void 0:d.items[0])==null?void 0:_.legacy.full_text.slice(0,100))+"...":a=(u=(h=e.content)==null?void 0:h.items[0])==null?void 0:u.legacy.full_text;let i=e.url,t=`${a}

${i}
        `;copy(t),this.copying[o]=!1},500)},closeNotice(){this.showNotice=!1,localStorage.showNotice=!1},closeAd(){this.showAd=!1,localStorage.showAd=!1},getNewsList(e){return new Promise((o,a)=>{this.loading=!0,this.conditions.userAddress=this.$store.state.currentAccount,this.conditions.lang=this.language==="zh-cn"||this.language==="zh-tw"?"zh":"en",getNewsList(e).then(i=>{var n,r;let t=i==null?void 0:i.list;this.total=i==null?void 0:i.total,this.refreshing==!0&&(this.list=t),this.count==0&&(this.list=t,this.day=(n=this.list[0])!=null&&n.created_at?this.$f.formatDate(((r=this.list[0])==null?void 0:r.created_at)||"","YYYY-MM-DD"):"",this.$nextTick(()=>{var d;let l=this.$route.query.id;l&&((d=document.getElementById(l))==null||d.scrollIntoView())})),this.copying=this.list.map(l=>!1),this.count++,o(t)}).catch(i=>{this.error=!0,console.log(i)}).finally(()=>{this.loading=!1})})},async refresh(){this.refreshing=!0,this.conditions.pageNo=1,await this.getNewsList(this.conditions),this.refreshing=!1},async onLoad(){this.conditions.pageNo++;let e=await this.getNewsList(this.conditions);this.list.push(...e),this.list.length>=this.total&&(this.finished=!0)},dealDate(e){var o=Date.parse(new Date),a=e,i=parseInt(o)/1e3-parseInt(a);if(i=Math.abs(i),i<10)return this.$t("justNow");if(i<60&&i>=10)return Math.floor(i)+this.$t("ss");var t=i/60;if(t<60)return Math.floor(t)+this.$t("min");var n=i/3600;if(n<24)return Math.floor(n)+this.$t("hour");if(n>=24)return this.$f.formatDate(e)},view(e){this.$f.openBrowserAll(e.url)},getNewsAd(){getNewsAd().then(e=>{this.images=e||[]}).finally(()=>{})},newsVote(e,o,a){let i=this.$store.state.currentAccount;if(!i||i==="undefined"){this.$toast({message:this.$t("connectWalletFirst"),position:"top"});return}if(e.myVote==1&&o==1){this.$toast({message:this.$t("voted"),position:"top"});return}if(e.myVote==-1&&o==-1){this.$toast({message:this.$t("voted"),position:"top"});return}const t={userAddress:i,newsId:e.id,vote:o};newsVote(t).then(()=>{this.$toast({message:this.$t("success")}),this.list[a].myVote=o,o==1?(this.list[a].badCount=this.list[a].badCount>0?this.list[a].badCount-1:0,this.list[a].goodCount=this.list[a].goodCount+1):(this.list[a].badCount=this.list[a].badCount+1,this.list[a].goodCount=this.list[a].goodCount>0?this.list[a].goodCount-1:0)}).catch(n=>{this.$toast({message:n})})},ImagePreview}},_withScopeId=e=>(pushScopeId("data-v-5473704d"),e=e(),popScopeId(),e),_hoisted_1={class:"news-container"},_hoisted_2={class:"content"},_hoisted_3={class:"flex-between-notice"},_hoisted_4={class:"title"},_hoisted_5=_withScopeId(()=>createBaseVNode("i",{class:"iconfont icon-calendar blue"},null,-1)),_hoisted_6={class:"font-500"},_hoisted_7=_withScopeId(()=>createBaseVNode("use",{"xlink:href":"#icon-kaiqitongzhi"},null,-1)),_hoisted_8=[_hoisted_7],_hoisted_9=_withScopeId(()=>createBaseVNode("span",{class:"circle"},null,-1)),_hoisted_10=["onTouchstartPassive"],_hoisted_11={class:"flex-between"},_hoisted_12={class:"color-999"},_hoisted_13={class:"color-999"},_hoisted_14={key:0,class:"flex-start mt-10"},_hoisted_15=_withScopeId(()=>createBaseVNode("img",{src:_imports_0,style:{width:"30px",height:"30px"},alt:"",srcset:""},null,-1)),_hoisted_16={class:"ml-5"},_hoisted_17={class:"block title"},_hoisted_18=_withScopeId(()=>createBaseVNode("i",{class:"iconfont icon-v"},null,-1)),_hoisted_19={key:0,class:"color-999 font-10"},_hoisted_20=_withScopeId(()=>createBaseVNode("i",{class:"iconfont icon-forward font-10"},null,-1)),_hoisted_21={key:1,class:"title mt-10 block"},_hoisted_22={class:"color-666 mt-10"},_hoisted_23=["innerHTML"],_hoisted_24={class:"flex-end mt-10"},_hoisted_25=["onClick"],_hoisted_26={key:1,class:"ad",ref:"bottom"},_hoisted_27={class:"bg absolute-left"},_hoisted_28=["src","alt"];function _sfc_render(e,o,a,i,t,n){const r=resolveComponent("van-notice-bar"),l=resolveComponent("van-image"),d=resolveComponent("van-col"),_=resolveComponent("van-row"),h=resolveComponent("van-step"),u=resolveComponent("van-steps"),F=resolveComponent("van-list"),j=resolveComponent("van-pull-refresh"),H=resolveComponent("van-icon"),q=resolveComponent("van-swipe-item"),Y=resolveComponent("van-swipe");return openBlock(),createElementBlock("section",_hoisted_1,[t.showNotice?(openBlock(),createBlock(r,{key:0,ref:"top",wrapable:"",mode:"closeable",text:e.$t("newsTip"),onClose:n.closeNotice},null,8,["text","onClose"])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[withDirectives(createBaseVNode("div",_hoisted_4,[_hoisted_5,createBaseVNode("span",_hoisted_6,toDisplayString(t.day),1)],512),[[vShow,t.day]]),t.isShowNotice?(openBlock(),createElementBlock("svg",{key:0,class:"icon-svg notice","aria-hidden":"true",onClick:o[0]||(o[0]=(...s)=>e.$f.jumpNotice&&e.$f.jumpNotice(...s))},_hoisted_8)):createCommentVNode("",!0)]),createBaseVNode("div",{class:"container",ref:"middle",style:normalizeStyle({height:`calc(100vh - ${t.top}px - ${t.bottom}px)`})},[createVNode(j,{modelValue:t.refreshing,"onUpdate:modelValue":o[6]||(o[6]=s=>t.refreshing=s),onRefresh:n.refresh,"loosing-text":e.$t("loosingText"),"pulling-text":e.$t("pullingText"),"loading-text":e.$t("loading")},{default:withCtx(()=>[createVNode(F,{loading:t.loading,"onUpdate:loading":o[4]||(o[4]=s=>t.loading=s),finished:t.finished,"loading-text":e.$t("loading"),"finished-text":e.$t("noMore"),error:t.error,"onUpdate:error":o[5]||(o[5]=s=>t.error=s),"error-text":e.$t("errorText"),onLoad:n.onLoad},{default:withCtx(()=>[createVNode(u,{direction:"vertical",active:"active"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(t.list,(s,g)=>(openBlock(),createBlock(h,{key:g,id:s.id},{"inactive-icon":withCtx(()=>[_hoisted_9]),default:withCtx(()=>{var m,f,v,w,N,y,B,k,C,V,S,$,x,b,T,A,I,D,L,z,E,M,P;return[createBaseVNode("div",{class:normalizeClass(["item",{active:t.copying[g]}]),onContextmenu:o[1]||(o[1]=withModifiers(()=>{},["prevent"])),onTouchstartPassive:c=>n.longTap(s,g),onTouchmovePassive:o[2]||(o[2]=(...c)=>n.clearTouch&&n.clearTouch(...c)),onTouchendPassive:o[3]||(o[3]=(...c)=>n.clearTouch&&n.clearTouch(...c))},[createBaseVNode("div",_hoisted_11,[createBaseVNode("span",_hoisted_12,toDisplayString(n.dealDate(s.created_at)),1),createBaseVNode("span",_hoisted_13,toDisplayString(e.$t("source"))+toDisplayString(s.source),1)]),s.source==="twitter"?(openBlock(),createElementBlock("div",_hoisted_14,[createVNode(l,{class:"logo",width:"30px",height:"30px",src:(v=(f=(m=s.content)==null?void 0:m.items[0])==null?void 0:f.user)==null?void 0:v.profile_image_url_https,fit:"contain","lazy-load":"","loading-icon":`${e.$store.state.s3BaseUrl}logo/ave_gray.png`,"error-icon":`${e.$store.state.s3BaseUrl}logo/ave_gray.png`,round:""},{error:withCtx(()=>[_hoisted_15]),_:2},1032,["src","loading-icon","error-icon"]),createBaseVNode("div",_hoisted_16,[createBaseVNode("span",_hoisted_17,[createTextVNode(toDisplayString((y=(N=(w=s.content)==null?void 0:w.items[0])==null?void 0:N.user)==null?void 0:y.name),1),_hoisted_18]),(C=(k=(B=s.content)==null?void 0:B.items[0])==null?void 0:k.legacy)!=null&&C.retweeted_status_result?(openBlock(),createElementBlock("span",_hoisted_19,[_hoisted_20,createTextVNode("\xA0"+toDisplayString(e.$t("forward"))+toDisplayString(($=(S=(V=s.content)==null?void 0:V.items[0])==null?void 0:S.legacy)==null?void 0:$.retweeted_status_result.user.name),1)])):createCommentVNode("",!0)])])):(openBlock(),createElementBlock("span",_hoisted_21,toDisplayString((b=(x=s.content)==null?void 0:x.items[0])==null?void 0:b.legacy.title),1)),createBaseVNode("div",_hoisted_22,[createBaseVNode("div",{class:"overflow lineHight20",innerHTML:((I=(A=(T=s.content)==null?void 0:T.items[0])==null?void 0:A.legacy.full_text)==null?void 0:I.length)>500&&s.source!=="twitter"?((L=(D=s.content)==null?void 0:D.items[0])==null?void 0:L.legacy.full_text.slice(0,100))+"...":(E=(z=s.content)==null?void 0:z.items[0])==null?void 0:E.legacy.full_text},null,8,_hoisted_23),(P=(M=s.content)==null?void 0:M.items[0])!=null&&P.legacy.media?(openBlock(),createBlock(_,{key:0,gutter:"5",class:"mt-10"},{default:withCtx(()=>{var c,U;return[(openBlock(!0),createElementBlock(Fragment,null,renderList((U=(c=s.content)==null?void 0:c.items[0])==null?void 0:U.legacy.media,(p,R)=>(openBlock(),createBlock(d,{span:"8",key:R},{default:withCtx(()=>[p.type==="photo"?(openBlock(),createBlock(l,{key:0,src:p.media_url_https,width:"100%",fit:"contain","lazy-load":"","loading-icon":`${e.$store.state.s3BaseUrl}logo/ave_gray.png`,"error-icon":`${e.$store.state.s3BaseUrl}logo/ave_gray.png`,onClick:withModifiers(G=>n.ImagePreview({images:[p.media_url_https],closeable:!0}),["stop"])},null,8,["src","loading-icon","error-icon","onClick"])):createCommentVNode("",!0)]),_:2},1024))),128))]}),_:2},1024)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_24,[s.url?(openBlock(),createElementBlock("span",{key:0,class:"span1",onClick:c=>n.view(s)},toDisplayString(e.$t("view")),9,_hoisted_25)):createCommentVNode("",!0)])],42,_hoisted_10)]}),_:2},1032,["id"]))),128)),createVNode(h,null,{"inactive-icon":withCtx(()=>[]),_:1})]),_:1})]),_:1},8,["loading","finished","loading-text","finished-text","error","error-text","onLoad"])]),_:1},8,["modelValue","onRefresh","loosing-text","pulling-text","loading-text"])],4)]),t.showAd&&t.images.length>0?(openBlock(),createElementBlock("div",_hoisted_26,[createBaseVNode("span",_hoisted_27,toDisplayString(e.$t("ad")),1),createVNode(H,{class:"bg absolute-right",name:"cross",onClick:n.closeAd},null,8,["onClick"]),createVNode(Y,{class:"my-swipe",autoplay:3e3,"indicator-color":"white"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(t.images,s=>(openBlock(),createBlock(q,{key:s},{default:withCtx(()=>[createBaseVNode("img",{src:s.PictureLink,alt:s.remark},null,8,_hoisted_28)]),_:2},1024))),128))]),_:1})],512)):createCommentVNode("",!0)])}var news=_export_sfc(_sfc_main,[["render",_sfc_render],["__scopeId","data-v-5473704d"]]);export{news as default};
